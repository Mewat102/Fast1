<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Location + Message</title>
</head>
<body>
  <h2>Share Location + Message</h2>

  <button onclick="getLocation()">üìç Get Location</button>
  <p id="locMsg"></p>

  <textarea id="msg" placeholder="Type your message..." rows="4" cols="30"></textarea><br><br>

  <button onclick="submitData()">‚úÖ Submit</button>
  <p id="status"></p>

<script>
let latitude = '', longitude = '';

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        latitude = pos.coords.latitude;
        longitude = pos.coords.longitude;
        document.getElementById('locMsg').innerText = 
          `Latitude: ${latitude}, Longitude: ${longitude}`;
      },
      (err) => {
        document.getElementById('locMsg').innerText = 
          '‚ö† Location access denied or unavailable!';
      }
    );
  } else {
    document.getElementById('locMsg').innerText = '‚ùå Geolocation not supported.';
  }
}

async function submitData() {
  if (!latitude || !longitude) {
    document.getElementById('status').innerText = '‚ö† Please get location first!';
    return;
  }

  const payload = {
    message: document.getElementById('msg').value,
    latitude,
    longitude
  };

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbz8suBhlxuRwNSyD_oZSAapQNTK3nZZY4Y3mr9RBqR1XJbZtrv4OGLwEv6IFOe2OKZ4Mg/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const json = await res.json();
    document.getElementById('status').innerText = 
      json.status === 'ok' ? '‚úÖ Submitted successfully!' : '‚ùå Error submitting!';
  } catch (e) {
    document.getElementById('status').innerText = '‚ùå Network error!';
  }
}
</script>
</body>
</html>
